<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Plan PDF Parser</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-6">
  <h1 class="text-2xl font-bold mb-4">Upload Your Trainer PDF</h1>
  <input type="file" id="pdf-upload" accept="application/pdf" class="mb-6 p-2 border rounded" />
  <div id="output" class="space-y-6"></div>

  <script>
    document.getElementById('pdf-upload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async function () {
        const typedArray = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;
        let fullText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          fullText += content.items.map(item => item.str).join(' ') + '\n';
        }

        parseAndRenderWorkout(fullText);
      };
      reader.readAsArrayBuffer(file);
    });

    function parseAndRenderWorkout(text) {
      const container = document.getElementById('output');
      container.innerHTML = '';

      const garbageKeywords = [
        'WORKOUT SCHEDULE', 'CLICK THE NAME TO WATCH',
        'Day Day', 'Week 4 Week 3 Week 2 Week 1',
        'Day 30 Day 1', 'Welcome back to team Samouy'
      ];

      const isGarbage = line => garbageKeywords.some(kw => line.includes(kw));

      const sectionMarkers = [
        { title: 'Workout: Chest & Triceps', regex: /CHEST|TRICEPS/i },
        { title: 'Workout: Back & Biceps', regex: /BACK|BICEPS/i },
        { title: 'Workout: Shoulders', regex: /SHOULDER/i },
        { title: 'Workout: Legs', regex: /LEGS|CALF/i },
        { title: 'Stretching', regex: /STRETCH|anchor|behind back/i },
        { title: 'Rehabilitation', regex: /REHAB|PLANK|BIRD DOG|SIDE PLANK|KNEE EXTENSION|GLUTE/i },
        { title: 'Warm-up & Activation', regex: /WARM ?UP|ACTIVATION|MOBILITY/i },
        { title: 'Uncategorized', regex: /.*/ }
      ];

      sectionMarkers.forEach(section => {
        const matchedLines = text.split(/\n|\./)
          .map(line => line.trim())
          .filter(line => section.regex.test(line) && line.length > 10 && !isGarbage(line));

        if (!matchedLines.length) return;

        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow';

        const title = document.createElement('h2');
        title.className = 'text-xl font-semibold mb-4';
        title.textContent = section.title;
        div.appendChild(title);

        const ul = document.createElement('ul');
        ul.className = 'space-y-2';

        matchedLines.forEach(rawLine => {
          const li = document.createElement('li');
          li.className = 'flex items-start space-x-2';

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'mt-1';

          const label = document.createElement('label');
          label.className = 'text-sm';
          label.innerHTML = rawLine
            .replace(/TEMPO/gi, '<strong class="text-indigo-600">TEMPO</strong>')
            .replace(/\d+\s*(Sets?|Reps?|secs?)/gi, match => `<span class="text-green-700">${match}</span>`);

          li.appendChild(checkbox);
          li.appendChild(label);
          ul.appendChild(li);
        });

        div.appendChild(ul);
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
